{"version":3,"file":"auth.js","sourceRoot":"","sources":["../../routes/auth.ts"],"names":[],"mappings":";;AAAA,wCAA2C;AAC3C,gCAAmC;AAEnC,kBAAe,UAAA,GAAG;IACd,IAAM,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;IAC1B,IAAM,KAAK,GAAG,GAAG,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC;IAE1C,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAC,GAAG,EAAE,GAAG;QACxB,EAAE,CAAA,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,IAAI,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YAC/B,IAAA,aAA8B,EAA5B,gBAAK,EAAE,wBAAQ,CAAc;YAErC,KAAK,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,KAAK,OAAA,EAAE,EAAE,CAAC;iBAC9B,IAAI,CAAC,UAAC,IAAI;gBACP,EAAE,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAQ,CAAC,CAAC,CAAC,CAAC;oBAC5C,IAAM,OAAO,GAAG,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC;oBAChC,GAAG,CAAC,IAAI,CAAC;wBACL,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC,OAAO,EAAE,MAAM,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;qBACrE,CAAC,CAAC;gBACP,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;gBAC5C,CAAC;YACL,CAAC,CAAC,CAAC,KAAK,CAAC,cAAM,OAAA,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,YAAY,CAAC,EAAvC,CAAuC,CAAC,CAAC;QAChE,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;QAC5C,CAAC;IACL,CAAC,CAAC,CAAC;AACP,CAAC,CAAA","sourcesContent":["import HttpStatus = require('http-status');\r\nimport jwt = require('jwt-simple');\r\n\r\nexport default app => {\r\n    const config = app.config;\r\n    const Users = app.datasource.models.Users;\r\n\r\n    app.post('/token', (req, res) => {\r\n        if(req.body.email && req.body.password) {\r\n            const { email, password } = req.body;\r\n\r\n            Users.findOne({ where: { email } })\r\n                .then((user) => {\r\n                    if (Users.isPassword(user.password, password)) {\r\n                        const payload = { id: user.id };\r\n                        res.json({\r\n                            token: jwt.encode(payload, config.jwtSecret, undefined, undefined)\r\n                        });\r\n                    } else {\r\n                        res.sendStatus(HttpStatus.UNAUTHORIZED);\r\n                    }\r\n                }).catch(() => res.sendStatus(HttpStatus.UNAUTHORIZED));\r\n        } else {\r\n            res.sendStatus(HttpStatus.UNAUTHORIZED);\r\n        }\r\n    });\r\n}"]}