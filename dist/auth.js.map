{"version":3,"file":"auth.js","sourceRoot":"","sources":["../auth.ts"],"names":[],"mappings":";;AAAA,mCAAsC;AACtC,6CAAoD;AAEpD,kBAAe,UAAA,GAAG;IACd,IAAM,KAAK,GAAQ,GAAG,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC;IAC/C,IAAM,IAAI,GAAQ;QACd,WAAW,EAAE,GAAG,CAAC,MAAM,CAAC,SAAS;QACjC,cAAc,EAAE,yBAAU,CAAC,cAAc,EAAE;KAC9C,CAAC;IAEF,IAAM,QAAQ,GAAQ,IAAI,uBAAQ,CAAC,IAAI,EAAE,UAAC,OAAO,EAAE,IAAI;QACnD,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC;aACrB,IAAI,CAAC,UAAA,IAAI;YACN,EAAE,CAAA,CAAC,IAAI,CAAC,CAAC,CAAC;gBACN,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE;oBACd,EAAE,EAAE,IAAI,CAAC,EAAE;oBACX,KAAK,EAAE,IAAI,CAAC,KAAK;iBACpB,CAAC,CAAC;YACP,CAAC;YACD,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC,KAAK,CAAC,UAAA,KAAK,IAAI,OAAA,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,EAAjB,CAAiB,CAAC,CAAC;IAC7C,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAEvB,MAAM,CAAC;QACH,UAAU,EAAE,cAAM,OAAA,QAAQ,CAAC,UAAU,EAAE,EAArB,CAAqB;QACvC,YAAY,EAAE,cAAM,OAAA,QAAQ,CAAC,YAAY,CAAC,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,EAAlD,CAAkD;KACzE,CAAA;AACL,CAAC,CAAA","sourcesContent":["import passport = require('passport');\r\nimport { Strategy, ExtractJwt } from \"passport-jwt\";\r\n\r\nexport default app => {\r\n    const Users: any = app.datasource.models.Users;\r\n    const opts: any = {\r\n        secretOrKey: app.config.jwtSecret,\r\n        jwtFromRequest: ExtractJwt.fromAuthHeader()\r\n    };\r\n    \r\n    const strategy: any = new Strategy(opts, (payload, done) => {\r\n        Users.findById(payload.id)\r\n            .then(user => {\r\n                if(user) {\r\n                    return done(null, {\r\n                        id: user.id,\r\n                        email: user.email\r\n                    });\r\n                }\r\n                return done(null, false);\r\n            }).catch(error => done(error, null));\r\n    });\r\n\r\n    passport.use(strategy);\r\n\r\n    return {\r\n        initialize: () => passport.initialize(),\r\n        authenticate: () => passport.authenticate('jwt', app.config.jwtSecret)\r\n    }\r\n}"]}